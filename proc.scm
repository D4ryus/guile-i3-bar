(define-module (guile-i3-bar proc)
  #:use-module (guile-i3-bar misc)
  #:use-module (ice-9 rdelim)
  #:use-module (ice-9 regex)
  #:use-module (srfi srfi-1)
  #:export (read-proc-diskstats!
            read-proc-meminfo!
            read-proc-net-dev!
            read-proc-stat!))

(define read-proc-net-dev!
  (let* ((mapping (list
                   'received-bytes 'received-packets 'received-errors 'received-drop
                   'received-fifo 'received-frame 'received-compressed 'received-multicast
                   'transmitted-bytes 'transmitted-packets 'transmitted-errors 'transmitted-drop
                   'transmitted-fifo 'transmitted-colls 'transmitted-carrier 'transmitted-compressed))
         (device-rgx (make-regexp (format #f "^ *([a-zA-Z0-9-]+):狺あ磲灬礅溽ㄟㄩ溴铘轸ㄛ碍馆┅磲痧轭绌┅┅灬礅溽īㄣ犰飙鏖翳轭瘐舡骈戾痱镢铄舣溴觫灬礅溽痫螋换骈蝮赭扉铄狎桢徜弪蝈徜扉铄痫螋蝈徜扉铄痫螋戾祜镳è扉铄蝈徜扉铄痫螋┅蝈篚祠扉篝┅ㄩㄥ镦镡赍泗扉铄蝈鲥蝮蝈篚祠戾è磲翥蝈珏瓠屮邈溴鲩沐蜱扉铄┅ㄩ铒磲翥瑭ㄥ蝌矧⑻轭滹弩铒磲翥蝈珏孩扉铄祜镳蝈徜扉铄痫螋ㄣ镱ㄣ镱篝蜷铉眷轶痖骈邃簌礅镬磲翥韬篚怏趄轭磲翥暴磲泔铙磲痧轭磲篝蜷铉绢蹴忮ㄣ潋磲翥璀篚怏趄轭珞磲翥瑭┅┅蝈篚祠┅┅┅┅┅ㄤ彐轭蝈徜痱镢溟箅篝狒蟆戾舄è躅躞邃溟箅蜱磲脲蝈珏⑥郯馆郯馆坩镰诎弓莴癌あ┅磲痧轭扉篝蝈徜蟓泔眇戾翦蝈徜蟓礤蜱邃箦泗矧蟓蝈徜ы蟓箴孱舡蝈徜轭黩轸弩泔眇戾翦黩轸弩礤蜱邃箦泗矧蟓黩轸翦ы蟓箴孱舡黩轸轭ч锃轭痱镧蝈篌ы蟓箴孱舡轱麇殓梏邃箴孱舡轱т轶汜蜾蟓泔眇戾翦т轶汜蜾蟓礤蜱邃箦泗矧蟓溟筱狎溴ы蟓箴孱舡溟筱狎溟铉┅ㄤ轶氕蜱磲脲蝈珏ㄦ矧磲ｆ⑥郯馆郯馆ㄛ岘镰诎弓莴狺あ磲灬礅溽ㄟㄩ溴铘轸ㄛ碍馆┅磲痧轭绌┅疳螋轸轱瞽蜱磲脲蝈珏ㄦ矧磲ｆ⑥郯馆郯馆ㄛ岘镰诎弓莴┄郯馆狺あ磲灬礅溽ㄟㄩ溴铘轸ㄛ碍馆┅磲痧轭绌┅┅灬礅溽īㄣ犰飙鏖翳轭瘐舡骈戾痱镢溟箅篝狒螈灬礅溽痫螋戾祜镳è扉铄蝈徜扉铄痫螋┅蝈篚祠扉篝┅ㄩㄥ镦镡赍泗扉铄蝈鲥蝮蝈篚祠ㄩ蝈珏瓠屮邈躅躞邃溟箅蜱扉铄祜镳蝈徜扉铄痫螋蝈篚祠戾è磲翥蝈珏瓠屮邈溟箅蜱扉铄┅ㄩ铒磲翥瑭ㄥ蝌矧⑽磲翥栝铉蝈珏骘躅骘颌扉铄戾è疳螋轸轱瞽磲翥蝈珏瓠屮邈疳螋轸轱瞽蜱扉铄┅ㄩㄡ钿疳螋轸轱瞽磲翥铒铛祆蝈篚祠┅篝蜷铉痱彐轼簌礅镬倔趄轭ㄣ後蝈篚祠┅磲翥韬篚怏趄轭磲翥暴┅ㄢ彗轭ㄡ篌镢箦簟ㄣ溽蝈篚祠ю狎糸糸镱ㄡ痧孱ㄧ弭ㄣ溽蝈篚祠ю狎糸糸镱螬扉篝磲泔铙ㄣ镱ь磲痧轭绌磲篝蜷铉绢蹴忮ㄣ潋磲翥璀篚怏趄轭珞磲翥瑭┅┅┅祜镳蝈徜扉铄痫螋蝈篚祠┅祜镳蝈徜扉铄痫螋ㄣ镱ㄣ镱篝蜷铉眷轶痖骈邃簌礅镬磲翥韬篚怏趄轭磲翥暴扉篝ㄣ镱麸翎磲泔铙磲痧轭磲篝蜷铉绢蹴忮ㄣ潋磲翥璀篚怏趄轭珞磲翥瑭┅┅ㄣ镱ю狎糸糸镱Ж┅┅蝈篚祠┅┅┅┅┅┅┅ㄤ彐轭蝈徜痱镢篝狒戾舄è磲痧轭Ж躞弪铋沐簌篝屙殇戾轱麽轸轵箫骠轵篝遽珲弩珲弩舡铋沐┅蜱啜ㄣ瘐磲脲蝈珏ㄦ矧磲ｆ⑥沭狺あ磲灬礅溽ㄟㄩ溴铘轸ㄛ碍馆┅磲痧轭绌┅ㄣ矧弩磲脲蝈珏ㄦ矧磲ｆ⑥沭酲郯馆狺あ磲灬礅溽ㄟㄩ溴铘轸ㄛ碍馆┅磲痧轭绌┅ㄩ铘磲脲蝈珏⑥轭趄ㄛ碍莴─┅ㄣ豇磲脲蝈珏⑥泗ㄛ碍馆─┅ㄢ糸礤磲脲蝈珏⑥怍轫ㄛ碍馆─┅痱镢弩箦磲脲蝈珏⑥痱镢弩箦ㄛ碍馆─┅痱镢蟓蝓铑轭磲脲蝈珏⑥痱镢筮蝓铑轭ㄛ碍馆─┅痱镢蟓忪镢脲磲脲蝈珏⑥痱镢筮忪镢脲ㄛ碍馆─┅箫骠轵磲脲蝈珏ㄦ矧磲ｆ⑥箫骠轵狺あ磲灬礅溽ㄟㄩ溴铘轸ㄛ碍馆┅ㄣ镱п祆磲痧轭绌┅┅┅灬礅溽īㄣ犰飙鏖翳轭瘐舡骈戾痱镢篝狒灬礅溽痫螋戾祜镳è扉铄蝈徜扉铄痫螋┅蝈篚祠扉篝┅ㄣ矧弩扉篝┅ㄩㄥ镦镡赍泗扉铄ㄡ痧孱蝈鲥蝮蝈篚祠扉篝ㄣ镱с矧弩蝈鲥蝮泔蝈螬┅戾祜镳蜱è蝈珏蜱┅ㄩ铛祆蝈珏ㄥ蝌矧⑽磲翥栝铉蝈珏骘躅骘颌扉铄戾è钺礤ㄣ後蝈珏┅磲翥蝈珏瓠屮邈ㄣ溽蝈珏扉铄┅ㄩ铒磲翥瑭祜镳蜱ㄣ潋蝈珏┅ㄣ狍钺礤è沭箫骠轵瘵祜镳蝈徜扉铄痫螋ㄣ镱ㄣ镱钺礤磲泔铙ㄩㄥ聃犰钺礤箫骠轵瘵ㄣ镱п祆磲痧轭绌磲痧轭绌磲篝蜷铉绢蹴忮磲翥璀篚怏趄轭珞磲翥瑭┅蝈篚祠泔蝈螬è泔蝈螬祜镳蝈徜扉铄痫螋蝈篚祠ㄣ镱磲泔铙ㄣ镱ь磲痧轭绌磲篝蜷铉绢蹴忮磲翥璀篚怏趄轭珞磲翥瑭┅泔蝈螬┅è轭趄祜镳蝈徜扉铄痫螋ㄣ镱ㄣ镱钺礤磲篝蜷铉绢蹴忮篝蜷铉箴扉磲翥韬篚怏趄轭磲翥暴＼羽徙濠┅蝈篚祠泔蝈螬ㄥ祗祜镳蝈徜扉铄痫螋ㄣ镱ㄣ镱钺礤篝蜷铉绢蹴忮磲翥韬篚怏趄轭磲翥暴┅蝈篚祠泔蝈螬┅┅┅┅┅┅ㄤ彐轭蝈徜痱镢礤黹铈铩戾è蜱箝磲脲蝈珏⑥ㄛ岘镰诎龚┻藓莴┖ㄛ碍馆ㄛ岘镰谳─┅蜱磲脲蝈珏⑥ㄛ岘镰诎龚┻藓莴┖ㄛ碍馆─┅灬礅溽īㄣ犰飙鏖翳轭瘐舡骈戾痱镢礤黹铈铫灬礅溽痫螋戾祜镳è扉铄蝈徜扉铄痫螋┅蝈篚祠扉篝┅ㄩㄥ镦镡赍泗扉铄蝈鲥蝮蝈篚祠戾舄è矧蝈珏瓠屮邈蜱箝扉铄蝈珏瓠屮邈蜱扉铄ㄥ蝌矧⑽彘翳弪蝈珏磲翥桢骘颌扉铄┅ㄣ秕铘篝蜷铉绢蹴忮磲翥韬篚怏趄轭博┅躅轸ㄡ钿磲翥韬泔躅愆穿磲翥韬篚怏趄轭畅┅麒孱躅轸ㄣ镱è篝蜷铉娇躅轸㈦垄箦簟泔躅í泔躅卑鞍┅ǎㄥ蝌矧⒄铍铒黝躅轸躅轸┅┅祜镳蝈徜扉铄痫螋ㄣ镱ㄣ镱篝蜷铉眷轶痖骈邃簌礅镬磲翥韬篚怏趄轭暴泔躅舂蝈篚祠┅┅┅┅┅